
# مروری بر معماری RISC-V و دستورالعمل‌های RV32I

<div dir="rtl">

## تعریف دقیق ISA:
ISA به مجموعه‌ای از مشخصات و دستورالعمل‌ها گفته می‌شود که نحوه ارتباط نرم‌افزار با سخت‌افزار را تعیین می‌کند. به بیان ساده، ISA پل ارتباطی بین کدهایی که برنامه‌نویس می‌نویسد و سخت‌افزار پردازنده است.

### وظایف ISA:
ISA سه وظیفه اصلی دارد:

1. **تعریف دستورات قابل اجرا:**
   - چه دستوراتی توسط پردازنده قابل اجرا هستند، مانند:
     - عملیات محاسباتی (جمع، تفریق، ضرب و غیره).
     - دستورات انتقال داده (Load و Store).
     - دستورات کنترلی (Jump، Branch).

2. **تعریف منابع سخت‌افزاری:**
   - شامل تعداد و نوع رجیسترها، اندازه کلمه (Word Size) و ساختار حافظه.

3. **تعریف مدل برنامه‌نویسی:**
   - نحوه تعامل برنامه‌ها با سخت‌افزار، شامل نحوه استفاده از استک، رجیسترها و حافظه.

### اجزای ISA:
- **دستورالعمل‌ها:**
  - ISA مشخص می‌کند که چه دستورالعمل‌هایی وجود دارد و چه عملیاتی انجام می‌دهند.
  - مثال: دستور ADD برای جمع دو عدد.

- **انواع داده:**
  - ISA مشخص می‌کند که چه نوع داده‌هایی (مانند عدد صحیح، اعشاری) پشتیبانی می‌شوند.

- **رجیسترها:**
  - تعداد و نقش رجیسترهای موجود (مانند رجیسترهای عمومی، موقت، و استک).

- **حالت‌های آدرس‌دهی:**
  - نحوه دسترسی به داده‌ها در حافظه:
    - آدرس‌دهی مستقیم.
    - آدرس‌دهی غیرمستقیم.
    - آدرس‌دهی نسبی.

- **فرمت دستورات:**
  - ISA فرمت باینری دستورات را مشخص می‌کند:
    - طول دستورالعمل.
    - فیلدهای مختلف (مانند Opcode، Operandها).

### طبقه‌بندی ISA:
ISA‌ها بر اساس طراحی و کاربردشان طبقه‌بندی می‌شوند:
- **CISC (Complex Instruction Set Computer):**
  - مجموعه‌ای از دستورات پیچیده و قدرتمند.
  - مثال: معماری x86.
  - ویژگی‌ها:
    - تعداد دستورات زیاد.
    - دستورات پیچیده‌تر.

- **RISC (Reduced Instruction Set Computer):**
  - مجموعه‌ای از دستورات ساده و بهینه‌شده.
  - مثال: RISC-V، ARM.
  - ویژگی‌ها:
    - دستورات کم و ساده.
    - کارایی بالا.

- **VLIW (Very Long Instruction Word):**
  - استفاده از دستورات طولانی که چندین عملیات را همزمان انجام می‌دهند.

### اهمیت ISA:
- **انتخاب سخت‌افزار و نرم‌افزار:**
  - ISA تعیین می‌کند که کدام نرم‌افزارها روی کدام سخت‌افزار قابل اجرا هستند.

- **قابل حمل بودن نرم‌افزار:**
  - نرم‌افزارهایی که بر اساس یک ISA خاص نوشته شوند، می‌توانند روی تمام پردازنده‌هایی که از آن ISA پشتیبانی می‌کنند اجرا شوند.

- **طراحی پردازنده:**
  - ISA راهنمایی برای طراحی سخت‌افزار پردازنده است.

### مثال از ISA:
- **RISC-V:**
  - دستورات ساده و بهینه‌شده:
    - ADD x1, x2, x3: مقدار x2 + x3 را در رجیستر x1 ذخیره می‌کند.
    - LW x1, 0(x2): مقدار حافظه با آدرس x2+0 را در رجیستر x1 بارگذاری می‌کند.

- **x86:**
  - دستورات پیچیده‌تر:
    - MOV EAX, [EBX+4]: مقدار حافظه با آدرس EBX+4 را به رجیستر EAX منتقل می‌کند.

### ISA در RISC-V:
RISC-V یک ISA مدرن و بازمتن است که:
- ساده و مدولار است.
- برای تحقیقات و توسعه مناسب است.
- به دلیل سادگی، از نظر عملکرد بسیار کارآمد است.

## تعریف و جزئیات ABI:
ABI مشخص می‌کند که چگونه نرم‌افزارها و سخت‌افزار یا سیستم‌عامل با هم تعامل می‌کنند. این شامل مجموعه‌ای از قوانین و قراردادهاست که شامل موارد زیر می‌شود:

- **مجموعه رجیسترها و نحوه استفاده از آن‌ها:**
  - ABI مشخص می‌کند کدام رجیسترها برای چه اهدافی استفاده می‌شوند:
    - رجیسترهای آرگومان‌ها: برای انتقال آرگومان‌ها به توابع.
    - رجیسترهای بازگشتی: برای دریافت نتیجه بازگشتی از توابع.
    - رجیسترهای موقت و ذخیره‌شده: برخی از رجیسترها توسط تابع ذخیره می‌شوند و برخی دیگر به صورت موقتی استفاده می‌شوند.
  - به عنوان مثال، در RISC-V:
    - a0-a7: برای آرگومان‌ها و مقادیر بازگشتی.
    - t0-t6: رجیسترهای موقتی.
    - s0-s11: رجیسترهای ذخیره‌شده (saved registers).

- **نحوه انتقال آرگومان‌ها به توابع:**
  - ABI مشخص می‌کند که آرگومان‌ها چگونه از طریق رجیسترها یا استک به توابع ارسال شوند.

- **پروتکل استک:**
  - نحوه مدیریت استک، مانند:
    - ساختار استک.
    - نحوه ذخیره بازگشتی‌ها و متغیرهای محلی در استک.
    - چینش حافظه.

- **فرمت‌های باینری و فراخوانی توابع:**
  - ABI شامل جزئیاتی مانند فرمت فایل اجرایی (مانند ELF)، نحوه لینک کردن برنامه‌ها و نحوه فراخوانی توابع بین ماژول‌های مختلف است.

### ABI در RISC-V:
RISC-V از ABI استاندارد ILP32 و LP64 برای برنامه‌نویسی استفاده می‌کند:
- **ILP32:**
  - سایز int، long و pointer برابر با 32 بیت است.
  - برای سیستم‌های 32 بیتی مناسب است.

- **LP64:**
  - سایز long و pointer برابر با 64 بیت است.
  - برای سیستم‌های 64 بیتی مناسب است.

### مثال در ABI RISC-V:
رجیسترها برای آرگومان‌ها و مقادیر بازگشتی:
- آرگومان‌ها: a0-a7 (اولین 8 آرگومان).
- نتیجه بازگشتی: a0 (و در صورت نیاز a1 برای مقادیر بزرگ‌تر).

استفاده از رجیستر استک (sp):
- sp (stack pointer): برای مدیریت استک استفاده می‌شود.

رجیستر برنامه شمار (PC):
- رجیستر pc برای مشخص کردن آدرس دستور بعدی.

### اهمیت ABI:
- **سازگاری:**
  - ABI تضمین می‌کند که نرم‌افزارها بدون نیاز به تغییر کد منبع، در محیط‌های مختلف (سخت‌افزار یا سیستم‌عامل مشابه) قابل اجرا باشند.

- **ارتباط بین زبان‌های مختلف:**
  - ABI امکان ارتباط بین کدهایی که با زبان‌های مختلف نوشته شده‌اند (مانند C و Assembly) را فراهم می‌کند.

- **لینک کردن باینری‌ها:**
  - ABI تعیین می‌کند که چگونه کتابخانه‌ها و برنامه‌های جداگانه به هم لینک شوند.

### مثال ساده از کاربرد:
فرض کنید در زبان C تابع زیر را نوشته‌اید:

```c
int add(int a, int b) {
    return a + b;
}
```

هنگامی که این تابع کامپایل می‌شود:
- آرگومان‌ها (a و b) به ترتیب در رجیسترهای a0 و a1 قرار می‌گیرند.
- نتیجه بازگشتی (a + b) در رجیستر a0 ذخیره می‌شود.
- استک استفاده نمی‌شود مگر اینکه آرگومان‌های بیشتری وجود داشته باشد.

### در معماری کامپیوتر، register file یا پرونده ثبات‌ها مجموعه‌ای از ثبات‌ها (registers) است که به صورت سازمان‌یافته در کنار هم قرار گرفته‌اند و به پردازنده اجازه می‌دهند به سرعت داده‌ها و دستورالعمل‌ها را ذخیره و بازیابی کند. این ثبات‌ها بخشی از حافظه داخلی CPU هستند و به دلیل سرعت بالای دسترسی (در مقایسه با حافظه اصلی)، نقش بسیار مهمی در اجرای برنامه‌ها دارند.

### ویژگی‌های اصلی register file:
- **تعداد محدود ثبات‌ها:**
  - تعداد ثبات‌ها در یک پردازنده محدود است (معمولاً بین 16 تا 64 در معماری‌های مختلف، مثل MIPS یا RISC-V).

- **دسترسی سریع:**
  - ثبات‌ها به دلیل نزدیکی به واحد پردازش مرکزی (ALU) و طراحی سخت‌افزاری خاص، سریع‌ترین مکان برای ذخیره و بازیابی داده‌ها هستند.

- **ساختار سازمان‌یافته:**
  - دسترسی به ثبات‌ها معمولاً از طریق شماره‌گذاری (مانند x0 تا x31 در RISC-V) یا نام‌های خاص (مانند $t0 تا $t7 در MIPS) انجام می‌شود.

- **عملکرد چندپورت:**
  - برخی register fileها دارای چندین پورت خواندن و نوشتن هستند که به پردازنده اجازه می‌دهند به صورت موازی از ثبات‌ها بخوانند یا در آن‌ها بنویسند.

### وظایف اصلی:
- ذخیره مقادیر موقت برای استفاده سریع در محاسبات.
- نگهداری آدرس‌ها یا اشاره‌گرها در زمان اجرای برنامه‌ها.
- ارتباط بین واحد پردازش مرکزی (CPU) و حافظه اصلی.

### مثال در معماری RISC-V:
در RISC-V، register file شامل 32 ثبات 64 بیتی است (در حالت 64 بیتی)، که برخی از آن‌ها نقش خاصی دارند:
- x0: همیشه مقدار صفر دارد.
- x1 (ra): برای نگهداری آدرس بازگشت (Return Address).
- x2 (sp): برای اشاره به بالای پشته (Stack Pointer).

</div>
